dist: bionic
language: generic
env:
  global:
    - IMAGE_NAME=yyupw/covid19
    - REGISTRY_USER=yyupw
    - DOCKER_COMPOSE_VERSION=1.24.1
    - secure: "vxx29oFoE6RWIzvIWfAH6fPO+OH/sr33WgsD2jF/saNPbKdXP6eQ4u5vrPoEoqR3ZKD69lNArannKneNiAP6hh8PsWbNAbQN6mupcy5tvsY0kvwCi/l29PCexYjeIbgNT5fY9lAb9fUhmNjdTOIEsrc8dT4KsLG5dwvpk7n3ZO0NysZX2Jiaqj06AEQBPbZwKpiKPwUsobdvtIpuVRBcV0tINmwvLWlM+I+LoZmSBZdyliXeWBu5JrURURPzuGHpY73nQvrq0Zmc1HT5b0ypiVZdf6M0i38YbhcwYeCVUI46B9tz93BvoAeWZ+JJV0zJOdm8KPZJFb23uTLazjjjiZpGO0yB8epFXeq7II8oufej9xLo8guYwWQIAh9zF7p4P9SFowOYztm7tOmAyL4kz3TErNjj7Y6ASPfsOKtkRYxT/UWgRdcPNlxKkTnvpxngW4U+z6RmXyARpTIdxorC1imyo8ENgGaUcsLxVBt6Hvxxh9IGLazOt42/355sbXmXS0cQnThD2sk5+kZZ2rhQAFH9rpTVAc+Sc4JRtC3dSmWcjcoEN1v2RJpT1hBh1caQbVd+7a3I7IadIO/5rfdSrZ9MYSLOkWptYLkc+Q++KBBVC+g7Xz4jXHOIc/s6q4W2XW+l7n8lH/8Xo5/K8Qsb4tMN2mO6XkrYuZ15jNQaqts="
    - secure: "AFdty4XgcaOw5LGKgTiDfDUjGOLeeAhUhWshsTJ9WonPIpz7OGPOVFdCtbfFXBKwd7U7xGaIK6xyfraYfTFu1rY/w27x0XOAmiBj22KmhT0HUiBG2idMUuLnlFY+N/dGYhSGsjJMWNtoj0Yc8vgWIU3R4vmk01bI4SLThTU89BgjPdqP6bgfpL1CQ4XgerLFx+EA0s0ov8oBt7BHIO/yOPmE2fKlFdbNYNMcuMoHdNbBGkex5LukYzKKUrJDGbbDHgMm/IHv1oEov2fc686te6BtEQ9kwy+mgAzyc1Fp5ZU9U9p8sWfPr7R/6fQtxXeS7dt4e/GY7baMnfX7WxSZDjf+goY0qy4/yKDU3g1Olsxik9SUTdBvPwoNUtLWN5NfmMMexCwP5aQj5RFWBLJ3tWlfAeva44pm/y379cq9IPfXpkZMTGpBxwFBIYU3qOTywbznSM6qCGKzICUKXNNnV4pasTKlp9Ef36cSGP3EW5BLr8zEJ2cjVzrn9Waq6Lqq0lRH8f0tCJhQb80wp7P06xsx0pVvFarpTflVMlGWjKisllyJIWZMUyEQB6/wdy57uwgJOtBgxgOBZRl90c72fiJiihGneUMzgHInVLpH15g5OtkxHxHZylZgqQu9ugFokKurAc/pmjIx7N32FiHHTTbp101g1kFVUIf73gdXNEg="
services:
  - docker
before_install:
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
install:
  - docker-compose pull
  - docker-compose build
before_script:
  - wget -O covid19.tex https://gist.githubusercontent.com/wtsnjp/42a3379ddb496b3eeaa46c6de75e2e8b/raw
script:
  - docker-compose up --abort-on-container-exit
after_success:
  - ./travis/deploy_image.sh
  - ./travis/deploy_pdf.sh
after_failure:
  - cat covid19.log
